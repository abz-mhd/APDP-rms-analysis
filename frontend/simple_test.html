<!DOCTYPE html>
<html>
<head>
    <title>Simple Analysis Test</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .debug { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Simple Analysis Test</h1>
    <div class="debug" id="debug"></div>
    <div id="charts" class="row"></div>
    
    <script>
        const analysisType = 'peak-dining';
        
        function log(message) {
            const debug = document.getElementById('debug');
            debug.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }
        
        log('Starting test...');
        log('Plotly loaded: ' + (typeof Plotly !== 'undefined'));
        
        // Test analytics data
        fetch('/api/analytics/' + analysisType)
            .then(response => {
                log('Analytics response status: ' + response.status);
                return response.json();
            })
            .then(data => {
                log('Analytics data keys: ' + Object.keys(data).join(', '));
                
                // Test charts data
                return fetch('/charts/' + analysisType);
            })
            .then(response => {
                log('Charts response status: ' + response.status);
                return response.json();
            })
            .then(charts => {
                log('Charts keys: ' + Object.keys(charts).join(', '));
                
                // Try to render first chart
                const firstChartKey = Object.keys(charts)[0];
                if (firstChartKey) {
                    log('Attempting to render: ' + firstChartKey);
                    
                    const chartContainer = document.getElementById('charts');
                    chartContainer.innerHTML = '<div class="col-12"><div id="testChart" style="height: 400px;"></div></div>';
                    
                    const chartData = JSON.parse(charts[firstChartKey]);
                    log('Chart data parsed successfully');
                    
                    Plotly.newPlot('testChart', chartData.data, chartData.layout, {
                        responsive: true,
                        displayModeBar: false
                    }).then(() => {
                        log('✅ Chart rendered successfully!');
                    }).catch(error => {
                        log('❌ Chart rendering failed: ' + error.message);
                    });
                } else {
                    log('❌ No charts available');
                }
            })
            .catch(error => {
                log('❌ Error: ' + error.message);
            });
    </script>
</body>
</html>